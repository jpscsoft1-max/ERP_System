<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Sales</title>
  <!-- CHANGE: Company favicons -->
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="stylesheet" href="css/styles.css" />
  <!-- <script type="module" src="Sales.js"></script> -->

  <style>
    .sales-section {
      display: none;
      margin-top: 20px;
    }

    .sales-section h2 {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <div class="left-section">
      <img class="logo" src="LOGO_V1preview.png" alt="logo" />
      <p class="company">JPSCUBE ENGINEERS</p>
      <div class="header-actions">
        <button class="icon-btn back-btn" onclick="goBack()">‚Üê</button>
        <button class="icon-btn home-btn" onclick="goHome()">üè†</button>
      </div>
    </div>
    <div class="right-section">
      <input type="text" placeholder="Search..." class="search-bar" />
      <div class="nav-icons">
        <!-- <span class="notification-icon">üîî</span> -->
        <span class="notification-icon" id="notificationIcon">üîî</span>
        <div class="notification-panel" id="notificationPanel">
          <h4>Notifications</h4>
          <ul id="notificationList">
            <li>No new notifications</li>
          </ul>
        </div>
        <span class="profile-icon">üë§ Admin</span>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="Departments.html">Departments</a></li>
      <li><a href="WorkOrder.html">Work Order</a></li>
      <li><a href="Purchasing.html">Purchasing</a></li>
      <li><a href="Sales.html">Sales</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="finance.html">Finance</a></li>
      <li><a href="employees.html">Employees</a></li>
      <li><a href="generatelogin.html">Generate Login Details</a></li>
      <li><a href="Companyinfo.html">Company Info</a></li>
    </ul>
  </div>

  <div class="main-content">
    <h1>Sales</h1>
    <p>Manage your sales operations here.</p>
    <select id="salesSelector" class="purchase-dropdown" onchange="handleSalesChange(this.value)">
      <option value="" selected disabled>-- Select Section --</option>
      <option value="customers">Customers</option>
      <option value="quotes">Sales Quotes</option>
      <option value="orders">Sales Orders</option>
      <option value="invoices">Sales Invoice</option>
      <option value="returns">Sales Return Order</option>
    </select>

    <div id="customers" class="sales-section">
      <h2>Add Customer</h2>
      <form id="customerForm" onsubmit="saveCustomer(event)">
        <input type="text" id="customerName" placeholder="Customer Name" name="customerName" required />
        <input type="email" id="customerEmail" placeholder="Email ID" name="email" required />
        <input type="tel" id="customerMobile" placeholder="Mobile No." name="mobile" required />

        <div class="form-group" style="display: flex; align-items: center; gap: 20px;">
          <label style="margin-right: 10px;">GSTNO / PAN NO:</label>
          <label>
            <input type="radio" name="idType" value="GST" onchange="toggleIdInput()" required> GST No.
          </label>
          <label>
            <input type="radio" name="idType" value="PAN" onchange="toggleIdInput()" required> PAN No.
          </label>
        </div>
        <div id="idInputContainer" style="margin-top: 10px;"></div>

        <h3>Billing Address</h3>
        <textarea name="billingAddress" placeholder="Billing Address" required></textarea>

        <h3>Shipping Address</h3>

        <div id="shippingAddresses">
          <div class="shipping-group">
            <textarea name="shippingAddress[]" placeholder="Shipping Address" required></textarea>
            <div class="same-as-billing-container">
              <label>
                <input type="checkbox" class="same-as-billing" onchange="copyBillingAddress(this)">
                Same as billing address
              </label>
            </div>
          </div>
        </div>

        <button type="button" onclick="addShippingAddress()">Add Another Shipping Address</button>
        <br><br>
        <button type="submit">Save Customer</button>
      </form>
      <input type="text" id="searchInput" placeholder="Search customers..." oninput="filterCustomers()">
      <table id="customerTable" class="customer-table" border="1" cellpadding="5" cellspacing="0">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Mobile</th>
            <th>GST/PAN</th>
            <th>Billing Address</th>
            <th>Shipping Addresses</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="customerTableBody"></tbody>
      </table>

    </div>


    <div id="quotes" class="sales-section">
      <h2>Sales Quotes</h2>

      <!-- <div class="form-row">
        <label for="customerSelect"><strong>Select Customer:</strong></label>
        <select id="customerSelect" onchange="showCustomerDetails()">
          <option value="">-- Select Customer --</option>
        </select>
      </div> -->
   <!-- ===== Searchable dropdown for Sales Quotes (replace old input/datalist) ===== -->
<div class="form-row" style="position:relative;">
  <label for="quoteCustomerIndex"><strong>Select Customer:</strong></label>

  <div class="searchable-select customer-dropdown" id="quoteCustomerWrapper" style="display:inline-block;">
    <button type="button" class="searchable-select-toggle" id="quoteCustomerToggle">
      <span id="quoteCustomerLabel">-- Select Customer --</span>
      <span class="caret">‚ñæ</span>
    </button>

    <div class="searchable-select-menu" id="quoteCustomerMenu" style="display:none; position:absolute; z-index:999; background:#fff; border:1px solid #ddd; padding:8px; width:300px;">
      <input type="text" id="quoteCustomerSearch" class="searchable-select-input" placeholder="Search customer..." autocomplete="off" style="width:100%; box-sizing:border-box;"/>
      <ul id="quoteCustomerList" style="list-style:none; padding-left:0; max-height:220px; overflow:auto; margin-top:8px;"></ul>
    </div>
  </div>

  <!-- Hidden input used to store selected index for quotes -->
  <input type="hidden" id="quoteCustomerIndex" />
</div>



      <div class="form-row">
        <label for="quotationNo"><strong>Quotation No:</strong></label>
        <input type="text" id="quotationNo" />

        <label for="quotationDate" style="margin-left: 20px;"><strong>Quotation Date:</strong></label>
        <input type="date" id="quotationDate" />
      </div>

      <div id="customerInfo" style="margin-top: 20px; display: none;">
        <p><strong>Customer Name:</strong> <span id="custName"></span></p>
        <p><strong>Address:</strong> <span id="custAddress"></span></p>
        <p><strong>GSTIN / PAN:</strong> <span id="custId"></span></p>
        <p><strong>Mobile No:</strong> <span id="custMob"></span></p>
        <!-- Quotation Items Section -->
        <div style="margin-top: 20px;">
          <h3>Quotation Items</h3>
          <table id="quotationItems" border="1" cellpadding="5" cellspacing="0">
            <thead>
              <tr>
                <th>Sr No.</th>
                <th>Item Description</th>
                <th>Item Code</th>
                <th>HSN/SAC</th>
                <th>Qty</th>
                <th>Rate Per-each</th>
                <th>GST %</th>
                <th>Tax</th>
                <th>Total</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="itemsBody">
              <!-- Dynamic rows go here -->
            </tbody>
          </table>
          <button type="button" onclick="addQuotationItem()">+ Add Item</button>
          <br><br>
          <!-- <p><strong>Grand Total: ‚Çπ<span id="grandTotal">0.00</span></strong></p>
            -->
          <p><strong>Grand Total: ‚Çπ<span id="orderGrandTotal">0.00</span></strong></p>

          <button class="print-btn" onclick="previewQuotation()">üñ®Ô∏è Print Sales Quote</button>
          <!-- üîò Print Quote Button -->

        </div>
      </div>
    </div>

    <div id="orders" class="sales-section">
      <h2>Sales Orders</h2>

      <!-- <div class="sales-orders-row">
        <label for="orderCustomer"><strong>Select Customer:</strong></label>
        <select id="orderCustomer" class="order-customer-dropdown" onchange="showOrderCustomerDetails()">
          <option value="">-- Select Customer --</option>
        </select>
      </div> -->
<!-- Safe searchable dropdown for Orders (unique ids) -->
<div class="sales-orders-row" style="position:relative;">
  <label for="orderCustomerIndex"><strong>Select Customer:</strong></label>

  <div class="searchable-select customer-dropdown" id="orderCustomerWrapper" style="display:inline-block;">
    <button type="button" class="searchable-select-toggle" id="orderCustomerToggle">
      <span id="orderCustomerLabel">-- Select Customer --</span>
      <span class="caret">‚ñæ</span>
    </button>

    <div class="searchable-select-menu" id="orderCustomerMenu" style="display:none; position:absolute; z-index:999; background:#fff; border:1px solid #ddd; padding:8px; width:260px;">
      <input type="text" id="orderCustomerSearch" class="searchable-select-input" placeholder="Search customer..." autocomplete="off" style="width:100%; box-sizing:border-box;"/>
      <ul id="orderCustomerList" style="list-style:none; padding-left:0; max-height:220px; overflow:auto; margin-top:8px;"></ul>
    </div>
  </div>

  <!-- Hidden input used to store selected index (safe unique id) -->
  <input type="hidden" id="orderCustomerIndex" onchange="showOrderCustomerDetailsFromIndex()" />
</div>

      <div class="sales-orders-row">
        <label for="orderNo"><strong>Order No:</strong></label>
        <input type="text" id="orderNo" class="sales-orders-input" />

        <label class="sales-orders-label" for="orderDate" style="margin-left: 20px;"><strong>Order
            Date:</strong></label>
        <input type="date" id="orderDate" class="sales-orders-input" />
      </div>

      <div id="orderCustomerInfo" class="sales-orders-details" style="margin-top: 20px; display: none;">
        <p><strong>Customer Name:</strong> <span id="orderCustName"></span></p>
        <p><strong>Address:</strong> <span id="orderCustAddress"></span></p>
        <p><strong>GSTIN / PAN:</strong> <span id="orderCustId"></span></p>
        <p><strong>Mobile No:</strong> <span id="orderCustMob"></span></p>
      </div>
      <!-- Sales Order Items Section -->
      <div style="margin-top: 20px;">
        <h3>Order Items</h3>
        <table id="orderItems" border="1" cellpadding="5" cellspacing="0">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>Item Description</th>
              <th>Item Code</th>
              <th>HSN/SAC</th>
              <th>Qty</th>
              <th>Rate Per-each</th>
              <th>GST %</th>
              <th>Tax</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="orderItemsBody">
            <!-- Rows go here -->

          </tbody>
        </table>
        <button type="button" onclick="addOrderItem()">+ Add Item</button>
        <br><br>
        <p><strong>Grand Total: ‚Çπ<span id="grandTotal">0.00</span></strong></p>
        <button class="print-btn">üñ®Ô∏è Print Sales Order</button> <!-- Placeholder for now -->
      </div>
    </div>

    <div id="invoices" class="sales-section invoice-section">
      <h2>Sales Invoices</h2>

      <!-- <div class="form-row">
        <label for="invoiceCustomer"><strong>Select Customer:</strong></label>
        <select id="invoiceCustomer" onchange="showInvoiceCustomerDetails()">
          <option value="">-- Select Customer --</option>
        </select>
      </div> -->
      <div class="form-row">
        <label for="invoiceCustomer"><strong>Select Customer:</strong></label>

        <!-- Custom searchable dropdown -->
        <div class="searchable-select" id="invoiceCustomerWrapper">
          <!-- Visible button jise click karke dropdown open hoga -->
          <button type="button" class="searchable-select-toggle" id="invoiceCustomerToggle">
            <span id="invoiceCustomerLabel">-- Select Customer --</span>
            <span class="caret">‚ñæ</span>
          </button>

          <!-- Dropdown menu -->
          <div class="searchable-select-menu" id="invoiceCustomerMenu">
            <!-- üîç Search row inside dropdown -->
            <input type="text" id="invoiceCustomerSearch" class="searchable-select-input"
              placeholder="Search customer..." />

            <!-- Options list yaha JS se aayenge -->
            <ul id="invoiceCustomerList"></ul>
          </div>
        </div>


        <input type="hidden" id="invoiceCustomer" onchange="showInvoiceCustomerDetails()" />
      </div>


      <div class="form-row">
        <label for="invoiceDate"><strong>Invoice Date:</strong></label>
        <input type="date" id="invoiceDate" />
      </div>

      <div id="invoiceCustomerInfo" style="margin-top: 20px; display: none;">
        <p><strong>Customer Name:</strong> <span id="invoiceCustName"></span></p>
        <p><strong>Address:</strong> <span id="invoiceCustAddress"></span></p>
        <p><strong>GSTIN / PAN:</strong> <span id="invoiceCustId"></span></p>
        <p><strong>Mobile No:</strong> <span id="invoiceCustMob"></span></p>
      </div>

      <div style="margin-top: 20px;">
        <h3>Invoice Items</h3>
        <table id="invoiceItems" border="1" cellpadding="5" cellspacing="0">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>Item Description</th>
              <th>Item Code</th>
              <th>HSN/SAC</th>
              <th>Qty</th>
              <th>Rate Per-each</th>
              <th>GST %</th>
              <th>Tax</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="invoiceItemsBody"></tbody>
        </table>
        <button type="button" onclick="addInvoiceItem()">+ Add Item</button>
        <br><br>
        <p><strong>Grand Total: ‚Çπ<span id="grandTotal">0.00</span></strong></p>
        <button class="print-btn">üñ®Ô∏è Print Invoice</button>
      </div>
    </div>


    <div id="returns" class="sales-section">
      <h2>Sales Return Orders</h2>
      <p>Manage sales return orders here.</p>
    </div>
  </div>

  <script type="module" src="js/Sales.js"></script>
  <script src="js/rolepermission.js"></script>


  <script src="js/notification.js"></script>
  <script src="js/login-check.js"></script>
  <script>function goBack() {
      window.history.back();
    }

    function goHome() {
      window.location.href = 'index.html';
    }
    // CHANGE: Expose navigation functions globally so header buttons work on this page
    window.goBack = goBack;
    window.goHome = goHome;

  </script>


</body>

</html>