<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Technical Department</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    body {
      background-color: #f4f8f9;
    }

    .main-content {
      padding: 20px;
    }

    h1 {
      color: #2d3e50;
      margin-bottom: 10px;
    }

    h2 {
      font-weight: bold;
      margin-bottom: 20px;
    }

    table {
      border-collapse: collapse;
      width: 60%;
      margin-top: 20px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 40px;
    }

    th,
    td {
      text-align: center;
      padding: 12px;
    }

    th {
      background-color: #f4f4f4;
      color: #000000;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:nth-child(odd) {
      background-color: #ffffff;
    }

    tr:hover {
      background-color: #eaf9ff;
    }

    #assignWorkForm {
      background-color: #fff;
      padding: 20px;
      width: 100%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      margin-bottom: 30px;
    }

    #assignWorkForm input[type="text"],
    #assignWorkForm input[type="date"] {
      width: 45%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #assignWorkForm select {
      width: 45%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #assignWorkForm button {
      padding: 10px 20px;
      background-color: #1abc9c;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    #assignWorkForm button:hover {
      background-color: #25ddb8;
    }

    #techCheckboxes {
      padding: 10px;
      width: 30%;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
   /* Modern Upgraded Table Style */
/* Modern Table for Assigned Work */
#assignedWorkTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 30px;
  background: #ffffff;
  border-radius: 12px;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
  font-size: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
}

/* Header */
#assignedWorkTable thead th {
  background-color: #1abc9c !important;
  color: white !important;
  text-align: center;
}


#assignedWorkTable th {
  padding: 14px 16px;
  text-align: center;   /* Fixed alignment */
  font-weight: 600;
  border-bottom: 1px solid #e0e0e0;
}

/* Table body */
#assignedWorkTable td {
  padding: 12px 16px;
  text-align: center;
  border-bottom: 1px solid #f0f0f0;
}

/* Hover effect */
#assignedWorkTable tbody tr:hover {
  background-color: #f8fdfc;
}

/* Action buttons */
#assignedWorkTable button {
  padding: 6px 14px;
  background-color: #e74c3c;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s ease;
}

#assignedWorkTable button:hover {
  background-color: #c0392b;
  transform: scale(1.05);
}



  </style>

</head>

<body>
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <div class="left-section">
      <img class="logo" src="LOGO_V1preview.png" alt="logo">
      <p class="company">JPSCUBE ENGINEERS</p>
      <div class="header-actions">
        <button class="icon-btn back-btn" onclick="goBack()">‚Üê</button>
        <button class="icon-btn home-btn" onclick="goHome()">üè†</button>
      </div>
    </div>
    <div class="right-section">
      <input type="text" placeholder="Search..." class="search-bar" />
      <div class="nav-icons">
        <span class="notification-icon" onclick="toggleNotification()">üîî</span>
        <span class="profile-icon" onclick="toggleProfileDropdown()">üë§ Admin</span>
      </div>
      <div id="notificationDropdown" class="dropdown-menu" style="display: none;">
        <a href="#">No new notifications</a>
      </div>
      <div id="profileDropdown" class="dropdown-menu" style="display: none;">
        <a href="#">Profile</a>
        <a href="login.html">Logout</a>
      </div>
    </div>
  </div>
  <!-- Sidebar -->
  <div class="sidebar">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="Departments.html">Departments</a></li>
      <li><a href="WorkOrder.html">Work Order</a></li>
      <li><a href="Purchasing.html">Purchasing</a></li>
      <li><a href="Sales.html">Sales</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="finance.html">Finance</a></li>
      <li><a href="employees.html">Employees</a></li>
      <li><a href="generatelogin.html">Generate Login Details</a></li>
      <li><a href="Companyinfo.html">Company Info</a></li>
    </ul>
  </div>
  <!-- Main Content -->
  <div class="main-content">
    <h1>Technical Department</h1>
    <h2>No. of Technicals:</h2>
    <table border="1">
      <thead>
        <tr>
          <th>Sr No</th>
          <th>Name</th>
          <th>Emp ID</th>
          <th>Mob No</th>
        </tr>
      </thead>
      <tbody id="technicalTableBody"></tbody>
    </table>
    <hr> <br>
    <h2>Assign Work:</h2>
    <form id="assignWorkForm">
      <label>Order Title:</label><br>
      <input type="text" id="orderTitle" required><br><br>

      <label>Start Date:</label><br>
      <input type="date" id="startDate" required><br><br>

      <label>Due Date:</label><br>
      <input type="date" id="dueDate" required><br><br>

      <label>Status:</label><br>
      <select id="status" required>
        <option value="Pending">Pending</option>
        <option value="In Progress">In Progress</option>
        <option value="Completed">Completed</option>
      </select><br><br>

      <label>Supervisor / Manager Name:</label><br>
      <input type="text" id="supervisor" required><br><br>

      <label>Assign To (Select Technicians):</label><br>
      <div id="techCheckboxes"></div><br>

      <button type="submit">Assign</button>
    </form>
    <h2>Assigned Work List:</h2>
<table id="assignedWorkTable">
  <thead>
    <tr>
      <th>Sr No</th>
      <th>Order Title</th>
      <th>Start Date</th> 
      <th>Due Date</th>
      <th>Status</th>
      <th>Supervisor</th>
      <th>Assigned To</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

  </div>
  <!-- Firebase Scripts -->
  <script type="module">
  import { db } from "./firebase-init.js";
  import {
    collection,
    getDocs,
    query,
    where,
    addDoc,
    deleteDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  // === 1. Load Technical Team Table ===
  const tableBody = document.getElementById("technicalTableBody");

  async function loadTechnicalTeam() {
    const querySnapshot = await getDocs(collection(db, "employees"));
    let srNo = 1;

    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      if (data.department?.toLowerCase() === "technical") {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${srNo++}</td>
          <td>${data.name || "-"}</td>
          <td>${data.empId || "-"}</td>
          <td>${data.contact || "-"}</td>
        `;
        tableBody.appendChild(row);
      }
    });
  }

  // === 2. Load Technicians into Checkboxes ===
  const techCheckboxesDiv = document.getElementById("techCheckboxes");

  async function loadTechnicians() {
    const q = query(collection(db, "employees"), where("department", "==", "Technical"));
    const snapshot = await getDocs(q);

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = data.name;
      checkbox.id = `tech_${docSnap.id}`;

      const label = document.createElement("label");
      label.htmlFor = checkbox.id;
      label.textContent = data.name;

      const container = document.createElement("div");
      container.appendChild(checkbox);
      container.appendChild(label);

      techCheckboxesDiv.appendChild(container);
    });
  }

  // === 3. Handle Form Submission ===
  const assignWorkForm = document.getElementById("assignWorkForm");

  assignWorkForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const orderTitle = document.getElementById("orderTitle").value.trim();
    const startDate = document.getElementById("startDate").value;
    const dueDate = document.getElementById("dueDate").value;
    const status = document.getElementById("status").value;
    const supervisor = document.getElementById("supervisor").value.trim();

    const assignedTo = [];
    techCheckboxesDiv.querySelectorAll("input[type=checkbox]:checked").forEach(cb => {
      assignedTo.push(cb.value);
    });

    const data = {
      orderTitle,
      startDate,
      dueDate,
      status,
      supervisor,
      assignedTo,
      createdAt: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "assigned_work"), data);
      alert("Work assigned successfully!");
      assignWorkForm.reset();
      loadAssignedWork(); // refresh after assigning
    } catch (err) {
      console.error("Error saving work assignment:", err);
      alert("Failed to assign work. Try again.");
    }
  });

  // === 4. Load Assigned Work Table ===
  const assignedTableBody = document.querySelector("#assignedWorkTable tbody");

  async function loadAssignedWork() {
    assignedTableBody.innerHTML = "";
    const snapshot = await getDocs(collection(db, "assigned_work"));
    let count = 1;

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${count++}</td>
        <td>${data.orderTitle}</td>
        <td>${data.startDate}</td>
        <td>${data.dueDate}</td>
        <td>${data.status}</td>
        <td>${data.supervisor}</td>
        <td>${(data.assignedTo || []).join(", ")}</td>
        <td><button onclick="deleteAssignment('${docSnap.id}')">Delete</button></td>
      `;

      assignedTableBody.appendChild(row);
    });
  }

  // === 5. Delete Assignment (Global Function) ===
  window.deleteAssignment = async function (id) {
    if (confirm("Are you sure you want to delete this work assignment?")) {
      try {
        await deleteDoc(doc(db, "assigned_work", id));
        alert("Assignment deleted.");
        loadAssignedWork(); // refresh table
      } catch (err) {
        console.error("Delete failed", err);
        alert("Failed to delete. Try again.");
      }
    }
  };

  // === Initial Loads ===
  loadTechnicalTeam();
  loadTechnicians();
  loadAssignedWork();
</script>



  <!-- JS Scripts -->
  <script>
    function goBack() {
      window.history.back(); // Go to previous page
    }
    function goHome() {
      window.location.href = 'index.html';
    }
    function toggleNotification() {
      const notificationDropdown = document.getElementById('notificationDropdown');
      const profileDropdown = document.getElementById('profileDropdown');
      profileDropdown.style.display = 'none';
      notificationDropdown.style.display = (notificationDropdown.style.display === 'block') ? 'none' : 'block';
    }

    function toggleProfileDropdown() {
      const notificationDropdown = document.getElementById('notificationDropdown');
      const profileDropdown = document.getElementById('profileDropdown');
      notificationDropdown.style.display = 'none';
      profileDropdown.style.display = (profileDropdown.style.display === 'block') ? 'none' : 'block';
    }

    document.addEventListener('click', function (event) {
      const notificationIcon = document.querySelector('.notification-icon');
      const profileIcon = document.querySelector('.profile-icon');
      const notificationDropdown = document.getElementById('notificationDropdown');
      const profileDropdown = document.getElementById('profileDropdown');

      if (!notificationIcon.contains(event.target) && !notificationDropdown.contains(event.target)) {
        notificationDropdown.style.display = 'none';
      }

      if (!profileIcon.contains(event.target) && !profileDropdown.contains(event.target)) {
        profileDropdown.style.display = 'none';
      }
    });

    // Active Link Highlight
    const currentPage = window.location.pathname.split("/").pop();
    const sidebarLinks = document.querySelectorAll(".sidebar ul li a");

    sidebarLinks.forEach(link => {
      if (link.getAttribute("href") === currentPage) {
        link.classList.add("active");
      }
    });
  </script>
  <script src="js/rolepermission.js"></script>
</body>

</html>